<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weather App</title>
<link rel="manifest" href="manifest.json">
<style>
    body {
        background-color: #121212;
        color: white;
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 0;
        padding: 20px;
    }
    .temperature {
        font-size: 48px;
        margin: 10px 0;
    }
    .secondary {
        font-size: 18px;
        margin-top: 8px;
        display: flex;
        justify-content: center;
        gap: 30px;
    }
    .secondary-value {
        font-size: 20px;
        font-weight: bold;
    }
    .secondary-label {
        font-size: 12px;
        opacity: 0.8;
    }
    .coords, .condition, .updated, .credit {
        margin-top: 8px;
    }
    button {
        background-color: #1e88e5;
        border: none;
        color: white;
        padding: 10px 14px;
        margin: 4px;
        font-size: 18px;
        border-radius: 6px;
        cursor: pointer;
    }
    button:hover {
        background-color: #1565c0;
    }
    .inline {
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }
</style>
</head>
<body>
    <h2 id="location">Loading location...</h2>
    <div class="temperature" id="temperature">-- Â°C</div>

    <div class="secondary">
        <div>
            <div class="secondary-value" id="humidity">--%</div>
            <div class="secondary-label">Humidity</div>
        </div>
        <div>
            <div class="secondary-value" id="aqi">--</div>
            <div class="secondary-label">AQI</div>
        </div>
    </div>

    <div class="coords" id="coords"></div>
    <div class="condition" id="condition"></div>

    <div class="updated">
        <span class="inline">
            <span id="updatedTime">Updated: --:--:--</span>
            <button id="refreshBtn">ðŸ”„</button>
        </span>
    </div>

    <div style="margin-top:8px;">
        <button id="decreaseInterval">âž–</button>
        <span id="intervalDisplay">60s</span>
        <button id="increaseInterval">âž•</button>
    </div>

    <div class="credit">APP-BY-JEET</div>

<script>
    const API_KEY = "679bddf7884949109fa193814251408";
    let autoRefreshInterval = 60;
    let intervalId;

    function getAqiCategory(aqi) {
        if (aqi <= 50) return "Good";
        if (aqi <= 100) return "Moderate";
        if (aqi <= 150) return "Unhealthy for Sensitive Groups";
        if (aqi <= 200) return "Unhealthy";
        if (aqi <= 300) return "Very Unhealthy";
        return "Hazardous";
    }

    function fetchWeather(lat, lon) {
        // Reverse geocoding for accurate location name
        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`)
        .then(res => res.json())
        .then(locData => {
            let name = locData.address.city || locData.address.town || locData.address.village || "Unknown";
            let state = locData.address.state || "";
            document.getElementById('location').innerText = `${name}, ${state}`;
        });

        // WeatherAPI data
        fetch(`https://api.weatherapi.com/v1/current.json?key=${API_KEY}&q=${lat},${lon}&aqi=yes`)
        .then(res => res.json())
        .then(data => {
            document.getElementById('temperature').innerText = `${data.current.temp_c} Â°C`;
            document.getElementById('coords').innerText = `Latitude: ${lat.toFixed(4)}, Longitude: ${lon.toFixed(4)}`;
            document.getElementById('condition').innerText = data.current.condition.text;
            document.getElementById('humidity').innerText = `${data.current.humidity}%`;

            let aqiValue = data.current.air_quality["pm2_5"];
            document.getElementById('aqi').innerText = `${aqiValue.toFixed(1)} (${getAqiCategory(aqiValue)})`;

            const now = new Date();
            document.getElementById('updatedTime').innerText = "Updated: " + now.toLocaleTimeString();
        })
        .catch(err => console.error(err));
    }

    function getLocationAndUpdate() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(pos => {
                fetchWeather(pos.coords.latitude, pos.coords.longitude);
            }, err => {
                console.error(err);
                document.getElementById('location').innerText = "Location access denied";
            });
        } else {
            alert("Geolocation not supported");
        }
    }

    document.getElementById('refreshBtn').addEventListener('click', getLocationAndUpdate);

    document.getElementById('increaseInterval').addEventListener('click', () => {
        autoRefreshInterval += 10;
        document.getElementById('intervalDisplay').innerText = `${autoRefreshInterval}s`;
        restartAutoRefresh();
    });

    document.getElementById('decreaseInterval').addEventListener('click', () => {
        if (autoRefreshInterval > 10) {
            autoRefreshInterval -= 10;
            document.getElementById('intervalDisplay').innerText = `${autoRefreshInterval}s`;
            restartAutoRefresh();
        }
    });

    function restartAutoRefresh() {
        clearInterval(intervalId);
        intervalId = setInterval(getLocationAndUpdate, autoRefreshInterval * 1000);
    }

    getLocationAndUpdate();
    restartAutoRefresh();
</script>
</body>
</html>
